<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e0e5ec;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .login-box {
            background: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            transition: all 0.3s ease;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #333;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            transition: border 0.2s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #3498db;
        }

        input[type="submit"] {
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        input[type="submit"]:hover {
            background-color: #2c80b4;
        }

        #respuesta {
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            color: green;
        }

        /* ESTILO PARA LISTA DE PRODUCTOS */
        #productosBox {
            background: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            width: 100%;
        }

        #productosBox h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
        }

        #listaProductos {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #listaProductos li {
            background: #f1f1f1;
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            font-size: 16px;
            color: #333;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        #listaProductos li:hover {
            transform: translateY(-3px);
            background: #e8f4fd;
        }

        .tabla-contenedor {
            overflow-x: auto;
        }

        #tablaProductos {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 15px;
        }

        #tablaProductos thead {
            background-color: #3498db;
            color: white;
        }

        #tablaProductos th,
        #tablaProductos td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        #tablaProductos tr:hover {
            background-color: #f1f9ff;
        }

        #tablaProductos td {
            color: #333;
        }
    </style>
</head>

<body>
    <div id="contenedorPrincipal" style="width: 100%; max-width: 700px; margin: auto; padding: 20px;">
        <div style="text-align: center; margin-bottom: 20px;">
            <button id="btnProductos" style="padding: 10px 20px; margin-right: 10px; cursor: pointer;">Productos</button>
            <button id="btnUsuarios" style="padding: 10px 20px; cursor: pointer;">Usuarios</button>
            <button id="btnBack" style="padding: 10px 20px; cursor: pointer;">Salir</button>
        </div>
        <div class="login-box" id="productosBox">
            <h2>Lista de Productos</h2>
            <div class="tabla-contenedor">
                <table id="tablaProductos">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Descripción</th>
                            <th>Stock</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filas insertadas por JS -->
                    </tbody>
                </table>
                <h3>Agregar Nuevo Producto</h3>
                <form id="nuevoProductoForm">
                    <label for="nuevoNombre">Nombre:</label>
                    <input type="text" id="nuevoNombre" required>

                    <label for="nuevoPrecio">Precio:</label>
                    <input type="number" id="nuevoPrecio" step="0.01" required>

                    <label for="nuevaDescripcion">Descripción:</label>
                    <input type="text" id="nuevaDescripcion" required>

                    <label for="nuevoStock">Stock:</label>
                    <input type="number" id="nuevoStock" required>

                    <input type="submit" value="Agregar Producto">
                </form>

                <p id="respuestaProducto"></p>
            </div>
        </div>
        <div id="usuariosBox" class="login-box" style="display:none;">
            <h2>Lista de Usuarios</h2>
            <div class="tabla-contenedor">
                <table id="tablaUsuarios" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Contraseña</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Aquí se cargan usuarios con JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        const btnProductos = document.getElementById('btnProductos');
        const btnUsuarios = document.getElementById('btnUsuarios');
        const productosBox = document.getElementById('productosBox');
        const usuariosBox = document.getElementById('usuariosBox');
        const btnregresar = document.getElementById('btnBack');

        btnregresar.addEventListener('click', () => {
            window.location.href = 'index.html';
        });

        btnProductos.addEventListener('click', () => {
            productosBox.style.display = 'block';
            usuariosBox.style.display = 'none';
            obtenerProductos();
        });

        btnUsuarios.addEventListener('click', () => {
            usuariosBox.style.display = 'block';
            productosBox.style.display = 'none';
            obtenerUsuarios();
        });

        function obtenerProductos() {
            fetch('http://localhost:5001/products')
                .then(res => res.json())
                .then(data => {
                    const tablaBody = document.querySelector('#tablaProductos tbody');
                    tablaBody.innerHTML = ''; // limpia tabla anterior
                    data.forEach(p => {
                        console.log(p)
                        const fila = document.createElement('tr');
                        fila.innerHTML = `
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>$${p.price.toFixed(2)}</td>
                    <td>${p.description}</td>
                    <td>${p.stock}</td>
                    <td>
                        <button onclick="eliminarProducto(${p.id})" style="margin-right: 8px;">Eliminar</button>
                        <button onclick="actualizarProducto(${p.id}, '${p.name}', ${p.price}, '${p.description}', ${p.stock})">Actualizar</button>
                    </td>
                `;
                        tablaBody.appendChild(fila);
                    });
                })
                .catch(err => {
                    console.error("Error al obtener productos", err);
                });
        }


        const nuevoProductoForm = document.getElementById('nuevoProductoForm');
        const respuestaProducto = document.getElementById('respuestaProducto');

        nuevoProductoForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const nuevoProducto = {
                name: document.getElementById('nuevoNombre').value,
                price: parseFloat(document.getElementById('nuevoPrecio').value),
                description: document.getElementById('nuevaDescripcion').value,
                stock: parseInt(document.getElementById('nuevoStock').value)
            };

            fetch('http://localhost:5001/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(nuevoProducto)
            })
                .then(res => {
                    if (!res.ok) throw new Error('Error al agregar producto');
                    return res.json();
                })
                .then(data => {
                    respuestaProducto.textContent = '✅ Producto agregado correctamente.';
                    respuestaProducto.style.color = 'green';
                    nuevoProductoForm.reset();
                    obtenerProductos(); // recarga la tabla
                })
                .catch(err => {
                    console.error(err);
                    respuestaProducto.textContent = '❌ Error al agregar producto.';
                    respuestaProducto.style.color = 'red';
                });
        });

        function eliminarProducto(id) {
            if (confirm("¿Estás seguro de que deseas eliminar este producto?")) {
                fetch(`http://localhost:5001/products/${id}`, {
                    method: 'DELETE'
                })
                    .then(res => {
                        if (!res.ok) throw new Error("No se pudo eliminar");
                        return res.json();
                    })
                    .then(data => {
                        alert("Producto eliminado correctamente");
                        obtenerProductos();
                    })
                    .catch(err => {
                        console.error("Error al eliminar producto:", err);
                        alert("Error al eliminar producto");
                    });
            }
        }

        function actualizarProducto(id, nombre, precio, descripcion, stock) {
            const nuevoNombre = prompt("Nuevo nombre:", nombre);
            const nuevoPrecio = prompt("Nuevo precio:", precio);
            const nuevaDescripcion = prompt("Nueva descripción:", descripcion);
            const nuevoStock = prompt("Nuevo stock:", stock);

            if (nuevoNombre && nuevoPrecio && nuevaDescripcion && nuevoStock) {
                const productoActualizado = {
                    name: nuevoNombre,
                    price: parseFloat(nuevoPrecio),
                    description: nuevaDescripcion,
                    stock: parseInt(nuevoStock)
                };

                fetch(`http://localhost:5001/products/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productoActualizado)
                })
                    .then(res => {
                        if (!res.ok) throw new Error("No se pudo actualizar");
                        return res.json();
                    })
                    .then(data => {
                        alert("Producto actualizado correctamente");
                        obtenerProductos();
                    })
                    .catch(err => {
                        console.error("Error al actualizar producto:", err);
                        alert("Error al actualizar producto");
                    });
            }
        }

        function obtenerUsuarios() {
        fetch('http://localhost:5000/users')
            .then(res => res.json())
            .then(data => {
            const tablaBody = document.querySelector('#tablaUsuarios tbody');
            tablaBody.innerHTML = ''; // limpiar tabla
            data.forEach(user => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td>${user.email}</td>
                <td>${user.password}</td>
                <td>
                    <button onclick="eliminarUsuario(${user.id})" style="margin-right: 8px;">Eliminar</button>
                    <button onclick="actualizarUsuario(${user.id}, '${user.username}', '${user.email}', '${user.password}')">Actualizar</button>
                </td>
                `;
                tablaBody.appendChild(fila);
            });
            })
            .catch(err => console.error('Error al obtener usuarios:', err));
        }

        function eliminarUsuario(id) {
        if (confirm('¿Seguro que quieres eliminar este usuario?')) {
            fetch(`http://localhost:5000/users/${id}`, { method: 'DELETE' })
            .then(res => {
                if (!res.ok) throw new Error('No se pudo eliminar');
                alert('Usuario eliminado correctamente');
                obtenerUsuarios();
            })
            .catch(err => {
                console.error('Error al eliminar usuario:', err);
                alert('Error al eliminar usuario');
            });
        }
        }

        function actualizarUsuario(id, username, email, password) {
        const nuevoUsername = prompt('Nuevo nombre de usuario:', username);
        const nuevoEmail = prompt('Nuevo email:', email);
        const nuevoPassword = prompt('Nueva contraseña:', password);

        if (nuevoUsername && nuevoEmail && nuevoPassword) {
            fetch(`http://localhost:5000/users/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                username: nuevoUsername,
                email: nuevoEmail,
                password: nuevoPassword
            })
            })
            .then(res => {
                if (!res.ok) throw new Error('No se pudo actualizar');
                alert('Usuario actualizado correctamente');
                obtenerUsuarios();
            })
            .catch(err => {
                console.error('Error al actualizar usuario:', err);
                alert('Error al actualizar usuario');
            });
        }
        }

        // Opcional: formulario para agregar usuario (si quieres agregar uno, ejemplo):

        const nuevoUsuarioFormHTML = `
        <h3>Agregar Nuevo Usuario</h3>
        <form id="nuevoUsuarioForm">
            <label for="nuevoUsername">Nombre de usuario:</label>
            <input type="text" id="nuevoUsername" required>
            
            <label for="nuevoEmail">Email:</label>
            <input type="email" id="nuevoEmail" required>
            
            <label for="nuevoPassword">Contraseña:</label>
            <input type="password" id="nuevoPassword" required>
            
            <input type="submit" value="Agregar Usuario">
        </form>
        <p id="respuestaUsuario"></p>
        `;

        const usuariosBoxDiv = document.getElementById('usuariosBox');
        usuariosBoxDiv.insertAdjacentHTML('beforeend', nuevoUsuarioFormHTML);

        const nuevoUsuarioForm = document.getElementById('nuevoUsuarioForm');
        const respuestaUsuario = document.getElementById('respuestaUsuario');

        nuevoUsuarioForm.addEventListener('submit', e => {
        e.preventDefault();

        const nuevoUsuario = {
            username: document.getElementById('nuevoUsername').value,
            email: document.getElementById('nuevoEmail').value,
            password: document.getElementById('nuevoPassword').value
        };

        fetch('http://localhost:5000/users', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(nuevoUsuario)
        })
            .then(res => {
            if (!res.ok) throw new Error('Error al agregar usuario');
            return res.json();
            })
            .then(data => {
            respuestaUsuario.textContent = '✅ Usuario agregado correctamente.';
            respuestaUsuario.style.color = 'green';
            nuevoUsuarioForm.reset();
            obtenerUsuarios();
            })
            .catch(err => {
            console.error(err);
            respuestaUsuario.textContent = '❌ Error al agregar usuario.';
            respuestaUsuario.style.color = 'red';
            });
        });
        obtenerProductos();
    </script>

</body>

</html>